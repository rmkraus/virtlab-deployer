#!/usr/bin/ansible-playbook
---
- name: bootstrap
  gather_facts: no
  hosts: localhost

  roles:
    - name: infrastructure
    - name: inventory
      inventory_win_node_count: "{{ lookup('env', 'WIN_NODE_COUNT') }}"
      inventory_lab_prefix: "{{ lookup('env', 'LAB_PREFIX') }}"
      inventory_domain: "{{ lookup('env', 'AWS_R53_DOMAIN') }}"
      inventory_admin_password: "{{ lookup('env', 'ADMIN_PASSWORD') }}"

- name: configure windows hosts
  gather_facts: no
  hosts: windows

  roles:
    - name: available
    - name: winusers
      winusers_password: "{{ lookup('env', 'USER_PASSWORD') }}"
    #- name: winpatch

- name: configure console
  gather_facts: no
  hosts: console

  roles:
    - name: available
    #- name: patch
    - name: console
      console_user_pass: "{{ lookup('env', 'USER_PASSWORD') }}"
      console_admin_pass: "{{ lookup('env', 'ADMIN_PASSWORD') }}"
      console_domain: "{{ lookup('env', 'LAB_PREFIX') + '.' + lookup('env', 'AWS_R53_DOMAIN') }}"
      console_secret_key: "{{ lookup('env', 'ADMIN_PASSWORD') }}"
      console_user_count: "{{ lookup('env', 'WIN_NODE_COUNT') }}"
